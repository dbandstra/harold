// TODO: sample_rate should be handled specially:
// passed implicitly to child modules.
// it could even be hardcoded so you don't have to set it as a param at all

def Instrument:
    param sample_rate number;
    param freq number;
    param color number;
    param note_on boolean;

    osc PulseOsc;
    mod SineOsc;
begin
    * 0.7 @osc(
        color: $color,
        sample_rate: $sample_rate,
        freq:
            * $freq
                + 1
                    * 0.02 @mod(sample_rate: $sample_rate, freq: 4, phase: 0)
    )
end

def OuterInstrument:
    param sample_rate number;

    instr Instrument;
begin
    @instr(sample_rate: $sample_rate, freq: 440, color: 0.7, note_on: true)
end
